<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet">
    <style>
        .hidden {
            display: none;
          }
          .nested {
            padding-left: 20px; /* Adjust indentation as needed */
          }

          .isActive{

          }
    </style>
    <title>Event Logger</title>
  </head>
  <body class="bg-dark">

    <div class="d-flex flex-row justify-content-center">

        <div class="card p-3  mt-5 mr-3 ">
            <h4 class="card-title">
                Log Table
            </h4>
            <div class="card-body">
                <table id="main-table" class="table table-hover">
                    <thead>
                        <tr>
                            <th>Event</th>
                            <th>Creation Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for evnt in Events %}
                            <tr id={{evnt.name}} class="" style="cursor:Pointer" onClick=handleEventClick(this) >
                                <td>
                                    {{evnt.name}}
                                </td>
                                <td>
                                    {{evnt.createDate}}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card p-3 w-50 mt-5 mr-3 ">
            <h4 class="card-title">
                Log Table
            </h4>
            <div class="card-body">
                <table id="main-table" class="table table-hover">
                    <thead>
                        <tr>
                            <th class="w-25">Date</th>
                            <th>Log</th>
                        </tr>
                    </thead>
                    <tbody id="entryData">
                        
                    </tbody>
                    <tfoot>

                    </tfoot>
                </table>
            </div>
            <div class="card-footer">
                <button type="button" class="btn btn-info w-100" onClick=handleAddEntryButton(this)>
                    <span class="material-icons">add_circle_outline</span>
                </button>
            </div>
        </div>
    </div>


    <!-- Optional JavaScript -->
    <script>
        function handleEventClick(event){

            const thisElement = document.getElementById(event.id);
            const activeRows = document.getElementsByClassName("table-active");
            for(let i = 0; i < activeRows.length; i++){
                activeRows[i].className = "";
            } 
            thisElement.classList.add("table-active");


            console.log(event.id);
            const eventName = event.id;
            const tableElement = document.getElementById("entryData");
            // Delete all data first:
            while (tableElement.firstChild ) {
                tableElement.removeChild(tableElement.firstChild);
            }
            fetch("/api/event/" + event.id).then(Response => Response.json()).then(data => {
                for (let i = 0; i < data["entries"].length; i++) {
                    console.log(data["entries"][i]);
                    const row = document.createElement("tr");
                    const entryElement = document.createElement("td");
                    const dateElement = document.createElement("td");
                    entryElement.innerHTML = data["entries"][i]["entry"];
                    dateElement.innerHTML = data["entries"][i]["entryDate"];
                    row.appendChild(dateElement);
                    row.appendChild(entryElement);
                    tableElement.appendChild(row);
                }

            })
        }

        function handleAddEntryButton(event){
            const tableElement = document.getElementById("entryData");
              // Create a new table row element
            const newRow = document.createElement("tr");
            newRow.className = "";
            newRow.style ="height:100px;"

             // Create a new table cell element
            const newCell = document.createElement("td");
            newCell.colSpan = "2";
    
            const sendButton = document.createElement("button");
            sendButton.className='material-icons my-3 ';
            sendButton.innerHTML = "send";
            sendButton.Style='height:50px';
            

            // Create a new textbox element (input type="text")
            const newInput = document.createElement("textarea");
            newInput.type = "text";
            newInput.placeholder = "Enter your input";
            newInput.className = "align-self-stretch";
            newInput.style = "height:100px; width:90%; box-sizing: border-box; white-space:wrap; text-align:left; vertical-align:top"
            // Append the table cell to the new row
            newCell.appendChild(newInput);
            newRow.appendChild(newCell);
            newRow.appendChild(sendButton);

            // Append the new row to the table body
            tableElement.appendChild(newRow);
        };

        function handleAddEntry(event){
            fetch('/addEntry/', {
                method: 'POST', // Can be GET, PUT, DELETE, etc.
                body: JSON.stringify(data), // Convert data to JSON string
                headers: { 'Content-Type': 'application/json' }, // Specify content type
              }).then(response => response.json()) // Parse JSON response
              .then(data => {
                console.log('Success:', data);
              })
              .catch(error => {
                console.error('Error:', error);
              });
        }

        const table = document.getElementById('main-table');

        table.addEventListener('click', function(event) {
        if (event.target.tagName !== 'TR') return; // Only handle clicks on table rows
        const row = event.target;
        console.log(row);
            if (row.dataset.hasChildren === 'true') {
                const nestedRow = row.nextElementSibling;
                nestedRow.classList.toggle('hidden'); // Toggle visibility of nested row
            }
        });
    </script>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>